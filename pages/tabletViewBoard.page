<apex:page controller="AthenaLearningBoardDtls" extensions="mobileUserData,mobileActivityController" action="{!InserSession}" showheader="false" standardstylesheets="true" doctype="html-5.0" applybodytag="false" applyhtmltag="false">
    <head>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1"/>
    </head>
    <apex:includeScript value="{!$Resource.jquery172}"/>
    <apex:includeScript value="{!URLFOR($Resource.JQueryMobile, 'jquery.mobile-1.4.2/jquery.mobile-1.4.2.min.js')}" />
    <apex:stylesheet value="{!URLFOR($Resource.JQueryMobile, 'jquery.mobile-1.4.2/jquery.mobile-1.4.2.min.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.mobile_css, 'css/listview-grid.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.mobile_css, 'css/landing-page.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.mobile_css, 'css/mobiletemplate.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.mslp_res, 'fonts/icomoon/style.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.assets_athena, 'assets_athena/icomoon/iconMoon.css')}" />
    <script>
        var membersList = new Array();
    </script>        
    <style type="text/css" rel="stylesheet">
        @font-face {
        font-family:'HP Simplified';
        src:url('{!URLFOR($Resource.mslp_res, 'fonts/hpsimplified_w01_regular.eot')}'); 
        src:url('{!URLFOR($Resource.mslp_res, 'fonts/hpsimplified_w01_regular.eot?#iefix')}') format('embedded-opentype'), 
        url('{!URLFOR($Resource.mslp_res, 'fonts/hpsimplified_w01_regular.woff')}') format('woff'), 
        url('{!URLFOR($Resource.mslp_res, 'fonts/hpsimplified_w01_regular.ttf')}') format('truetype');
        font-weight:normal;
        font-style:normal;
        }
        body{
        font-family:"HP Simplified",sans-serif;
        color:#fff;
        }
        #startpage{
        background: #ececec;
        background-size:100% auto;
        }
        .ui-content{
        margin-left:270px;
        padding:0;
        }
        .ui-page-theme-a .ui-panel-wrapper, .ui-page-theme-a{
        /*background: -webkit-linear-gradient(#404040, #58595b);
        background: linear-gradient(#404040, #58595b);*/
        }
        .hpFont{
        font-family:"HP Simplified",sans-serif;
        white-space: nowrap !important;
        overflow: hidden !important;
        }
        #custom-collapsible{
        background-color:transparent !important;
        }
        .my-page .ui-listview li .ui-btn,
        .my-page .ui-listview .ui-li-thumb{
        border-top:none;
        border-radius:0 !important;
        background-color:transparent;
        border-bottom: 0px !important; 
        }
        .ui-listview .ui-li-has-thumb h2{
        text-align:center;
        height: 50px;
        line-height: 50px;
        max-height:50px !important;
        min-height:50px !important;
        }
        #pnl{
        background-color:#5e5e5e;
        margin-top:63px;
        }
        .infoFld{
        position:relative;
        background: #2f2c2d;
        min-height:65px;
        }
        .infoFld .circular{
        position:absolute;
        bottom:6px;
        left:20px;
        border:4px solid #fff;
        border-radius:40px;
        width:40px;
        height:40px;
        z-index:3;
        }
        .infoFld .name{
        bottom:0;
        left:0;
        margin:0;
        padding:6px 0;
        padding-top: 8px;
        padding-left:17px;
        width:100%;
        color:#fff;
        text-shadow:none;
        text-indent:60px;
        font-size:16pt !important;
        }
        .featureFld{
        padding:14px 0;
        background:#F9A006 url({!URLFOR($Resource.mslp_pic, 'pic/10.png')}) left 50% no-repeat;
        background-size:100% auto;
        }
        .featureFld .text{
        text-indent:36px;
        color:#fff;
        text-shadow:none;
        }
        .infoFld .menu_button{
        position:absolute;
        top:14px;
        right:6px;
        width:24px;
        height:24px;
        z-index:3;
        }
        #pnl .panel-list{
        background:#5e5e5e;
        }
        #pnl .panel-list li{
        background-color:transparent;
        min-height:60px;
        height:60px;
        }
        #pnl .panel-list li a{
        border-color:#767676;
        background-color:transparent;
        min-height:60px;
        height:60px !important;
        border-top-width:3px;
        font-weight:100;
        }
        #pnl .panel-list li a h2{
        font-weight:100;
        margin:0;
        }
        .panel-searchFld{
        padding:0 10px;
        }
        @font-face {
        font-family: 'ElegantIcons';
        src:url('{!URLFOR($Resource.mslp_res, 'fonts/ElegantIcons.eot')}');
        src:url('{!URLFOR($Resource.mslp_res, 'fonts/ElegantIcons.eot?#iefix')}') format('embedded-opentype'), 
        url('{!URLFOR($Resource.mslp_res, 'fonts/ElegantIcons.woff')}') format('woff'), 
        url('{!URLFOR($Resource.mslp_res, 'fonts/ElegantIcons.ttf')}') format('truetype'), 
        url('{!URLFOR($Resource.mslp_res, 'fonts/ElegantIcons.svg#ElegantIcons')}') format('svg');
        font-weight: normal;
        font-style: normal;
        }
        [data-hpa-icon]{
        background:none;
        }
        [data-hpa-icon]:before{
        font-family: 'ElegantIcons';
        color:#fff;
        font-size:30px;
        speak: none;
        font-weight: normal;
        font-variant: normal;
        text-transform: none;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        }
        [data-hpa-icon=menu]{
        text-decoration:none;
        }
        [data-hpa-icon=menu]:before{
        content:'\0061';
        font-size:39px;
        }
        .my-page .ui-listview li{
        height:150px;
        }
        @media all and (min-width: 420px) {
        .my-page .ui-listview li{
        height:200px;
        }
        }
        @media all and (min-width: 550px) {
        .my-page .ui-listview li{
        height:260px;
        }
        }
        @media all and (min-width: 650px) {
        .my-page .ui-listview li{
        height:250px;
        }
        }
        .ui-panel.ui-panel-open {
        position:fixed;
        }
        .ui-panel .ui-panel-inner {
        position: absolute;
        top: 1px;
        left: 0;
        right: 0;
        bottom: 0px;
        overflow:auto;
        -webkit-overflow-scrolling: touch;
        padding:0;
        }
        .icon-activity:before {        
        content: "\e70d";
        float: left;
        height: 60px;
        width: 30%;
        font-size: 32pt !important;
        text-shadow:none;
        color:white;
        text-align: center;
        vertical-align:middle;
        padding-top: 10px;
        position:absolute;
        min-width:90px;
        }
        .icon-community:before {        
        content: "\f0c0";
        float: left;
        height: 60px;
        width: 30%;
        font-size: 32pt !important;
        text-shadow:none;
        color:white;
        text-align: center;
        vertical-align:middle;
        padding-top: 10px;
        position:absolute;
        min-width:90px;
        }
        .icon-boards:before {        
        content: "\f044";
        float: left;
        height: 60px;
        width: 30%;
        font-size: 32pt !important;
        text-shadow:none;
        color:white;
        text-align: center;
        vertical-align:middle;
        padding-top: 10px;
        position:absolute;
        min-width:90px;
        }
        .icon-expert:before {        
        content: "\f0a3";
        float: left;
        height: 60px;
        width: 30%;
        font-size: 32pt !important;
        text-shadow:none;
        color:white;
        text-align: center;
        vertical-align:middle;
        padding-top: 10px;
        position:absolute;
        min-width:90px;
        }
        .icon-featured:before {        
        content: "\f02e";
        float: left;
        height: 60px;
        width: 30%;
        font-size: 32pt !important;
        text-shadow:none;
        color:white;
        text-align: center;
        vertical-align:middle;
        padding-top: 10px;
        position:absolute;
        min-width:90px;
        }
        .icon-trending:before {        
        content: "\f080";
        float: left;
        height: 60px;
        width: 30%;
        font-size: 32pt !important;
        text-shadow:none;
        color:white;
        text-align: center;
        vertical-align:middle;
        padding-top: 10px;
        position:absolute;
        min-width:90px;
        }
        .icon-logout:before {        
        content: "\e706";
        float: left;
        height: 60px;
        width: 30%;
        font-size: 32pt !important;
        text-shadow:none;
        color:white;
        text-align: center;
        vertical-align:middle;
        padding-top: 10px;
        position:absolute;
        min-width:90px;
        }
        .titleHeader {
        min-height:50px;
        width:100%; 
        background-color:#565656;          
        position: fixed;
        z-index: 1000;
        }
        .titleHeader h1 {
        color:white;
        text-shadow:none;
        margin:0;
        font-size:22pt;
        font-weight:100;
        padding-top: 7px;
        padding-left: 25px;
        }
        .ui-header .ui-title, .ui-footer .ui-title {
        margin-left: 0;
        width: 20%;
        }
        .tabletRow {
        padding:0;
        padding-left:80px;
        font-size:15pt;
        line-height:2.7;
        }
        .tabletRowHighlighedli {
        background-color:#404040 !important;
        height:60px !important;
        }
        .tabletRowHiglighteda {
        padding:0;
        padding-left:80px;
        font-size:15pt;
        height:60px !important;
        border-left-width: 4px !important;
        border-left-color: #0096d6 !important;
        line-height:2.7;
        }
        .ui-panel-closed {
        visibility: visible !important;  
        width: 90px !important; 
        left: 272px !important;
        overflow: visible !important;
        position:fixed;
        }
        .communityOwnerImg {
        width:40px;
        height:40px;
        }
        .listDivide {
        height:28px;
        color: white !important;
        font-size: 13pt !important;
        text-shadow: none !important;
        padding-left: 10px !important;
        background: linear-gradient(#545456, #404041);
        }
        .iconDisplayBG:after, .iconDisplayBG:before {
        border-top: 13px solid #767676; 
        content: '';
        height: 0;
        position: absolute;
        width: 0;
        top:45%;
        }
        .iconDisplayBG:after {
        border-right: 19px solid transparent;  
        right: 35px;  
        }
        .iconDisplayBG:before {
        border-left: 19px solid transparent;  
        right: 32px;  
        }
        .iconDisplayBG2:after, .iconDisplayBG2:before {
        border-top: 13px solid #767676; 
        content: '';
        height: 0;
        position: absolute;
        width: 0;
        top:45%;
        }
        .iconDisplayBG2:after {
        border-right: 19px solid transparent;  
        right: 8px;  
        }
        .iconDisplayBG2:before {
        border-left: 19px solid transparent;  
        right: 6px;  
        }
        .ui-listview>.ui-li-divider {
        padding: .3em 1.143em;
        font-size: 14px;
        font-weight: 100;
        cursor: default;
        outline: 0;
        border:none;
        }
        .ui-tabs {
        padding:0;
        background-color:#ECECEC;
        border-radius:0;
        }
        .ui-tabs ul li a {
        background-color:#ECECEC !important;
        border-bottom-width: 0 !important;
        border-top-width: 0 !important;
        border-color: #4d4d4d !important;
        }
        #gNav {
            width:40%;
            float:right;
        }
        #gNav ul li a {       
            
            background-color: white!important;
            border-bottom-width: 1px !important;
            border-top-width: 1px !important;
            border-right-width: 1px !important;
            border-color: lightgrey !important;
        }
        #taba {
            width:auto !important;
        }
        #tabb {
            width:auto !important;
        }
        #tabc {
            width:auto !important;
        }
        #tabd {
            width:auto !important;
        }
        
        .ui-page-theme-a .ui-btn.ui-btn-active, html .ui-bar-a .ui-btn.ui-btn-active, html .ui-body-a .ui-btn.ui-btn-active, html body .ui-group-theme-a .ui-btn.ui-btn-active, html head+body .ui-btn.ui-btn-a.ui-btn-active, .ui-page-theme-a .ui-checkbox-on:after, html .ui-bar-a .ui-checkbox-on:after, html .ui-body-a .ui-checkbox-on:after, html body .ui-group-theme-a .ui-checkbox-on:after, .ui-btn.ui-checkbox-on.ui-btn-a:after, .ui-page-theme-a .ui-flipswitch-active, html .ui-bar-a .ui-flipswitch-active, html .ui-body-a .ui-flipswitch-active, html body .ui-group-theme-a .ui-flipswitch-active, html body .ui-flipswitch.ui-bar-a.ui-flipswitch-active, .ui-page-theme-a .ui-slider-track .ui-btn-active, html .ui-bar-a .ui-slider-track .ui-btn-active, html .ui-body-a .ui-slider-track .ui-btn-active, html body .ui-group-theme-a .ui-slider-track .ui-btn-active, html body div.ui-slider-track.ui-body-a .ui-btn-active {
        color:#FBB03B;
        border-bottom-width: 0px !important;
        border-top-width: 0 !important;
        border-color: black !important;
        text-shadow:none;
        }
        .ui-content .ui-navbar li:last-child .ui-btn, .ui-content .ui-navbar .ui-grid-duo .ui-block-b .ui-btn {
        border-right-width: 0 !important;
        }
        .ui-btn:focus {
        box-shadow:none !important;
        }
        .ui-listview>li.ui-first-child img:first-child:not(.ui-li-icon) {
        border-radius:20px;
        }
        .ui-listview>li.ui-last-child img:first-child:not(.ui-li-icon) {
        border-radius:20px;
        }
        .ptext {
        float: right !important;
        text-align: right !important;
        padding-right: 45px !important;
        background: transparent !important;
        margin-bottom: -11px !important;
        color: white !important;
        text-shadow: none !important;
        font-size: 10pt !important;   
        }
        .normalTab {
        background-color:white !important; 
        border-color:lightgrey !important; 
        color:#333333 !important; 
        text-shadow:none !important;
        }
        .normalTab ui-btn-active {
        background-color:purple !important; 
        border-color:lightgrey !important; 
        color:#333333 !important; 
        text-shadow:none !important;
        }
        .ui-page-theme-b .ui-btn.ui-btn-active, html .ui-bar-b .ui-btn.ui-btn-active, html .ui-body-b .ui-btn.ui-btn-active, html body .ui-group-theme-b .ui-btn.ui-btn-active, html head+body .ui-btn.ui-btn-b.ui-btn-active, .ui-page-theme-b .ui-checkbox-on:after, html .ui-bar-b .ui-checkbox-on:after, html .ui-body-b .ui-checkbox-on:after, html body .ui-group-theme-b .ui-checkbox-on:after, .ui-btn.ui-checkbox-on.ui-btn-b:after, .ui-page-theme-b .ui-flipswitch-active, html .ui-bar-b .ui-flipswitch-active, html .ui-body-b .ui-flipswitch-active, html body .ui-group-theme-b .ui-flipswitch-active, html body .ui-flipswitch.ui-bar-b.ui-flipswitch-active, .ui-page-theme-b .ui-slider-track .ui-btn-active, html .ui-bar-b .ui-slider-track .ui-btn-active, html .ui-body-b .ui-slider-track .ui-btn-active, html body .ui-group-theme-b .ui-slider-track .ui-btn-active, html body div.ui-slider-track.ui-body-b .ui-btn-active {
        background-color:#2ad !important; 
        border-color:lightgrey !important; 
        color:#ffffff!important; 
        text-shadow:none !important;        
        }
        .ui-input-search  {        
        background-color: white !important;
        color:  black !important;
        text-shadow: none !important;
        border-color: lightgray !important;
        }

    </style>
    <body>
        <div data-role="page" id="startpage">
            <div data-role="panel" data-display="overlay" data-dismissible="false" id="pnl">
                <div class="infoFld">
                    <apex:image url="{!LoggedinUserDtls.FullPhotoUrl}" styleClass="circular" alt="no_username" />
                    <p class="name" id="uname">
                        <apex:outputLabel value="{!LoggedinUserDtls.Name}" style="font-size:16pt;"/>
                    </p>
                </div>
                <div class="ui-grid-c featureFld">
                    <div class="ui-block-a text">{!myBoardsCount}</div>
                    <div class="ui-block-b text">{!myBoardsContributedCount}</div>
                    <div class="ui-block-c text">{!followingCount}</div>
                    <div class="ui-block-d text">{!followersCount}</div>
                </div>
                <ul data-role="listview" style="margin: 0" data-theme="b" class="panel-list" id="listviewmenu">
                    <li data-icon="false">
                        <span class='icon-activity'></span>
                        <a id="t1" data-ajax="false" href="/apex/tabletActivityPage" class="hpFont tabletRow" onclick="event.stopPropagation();">
                            <h2 style="weight:100; text-shadow:none;">Activity</h2>
                        </a>
                    </li>
                    <li data-icon="false"><span class='icon-community'></span><a data-ajax="false" href="/apex/tabletMyCommunitiesPage" class="hpFont tabletRow" onclick="event.stopPropagation();"><h2>My Communities</h2></a></li>
                    <li data-icon="false"><span class='icon-expert'></span><a data-ajax="false" href="#" class="hpFont tabletRow" onclick="event.stopPropagation(); alert('Experts is not available on tablet. Please switch to the mobile version if you\'d like to use experts.')"><h2>Experts</h2></a></li>
                    <li data-icon="false">
                        <span class='icon-boards'></span>
                        <a id="t4" data-ajax="false" href="/apex/tabletMyBoardsPage" class="hpFont tabletRow" onclick="event.stopPropagation();">
                            <h2>My Boards</h2>
                        </a>
                    </li>
                    <li data-icon="false">
                        <span class='icon-featured'></span>
                        <a id="t5" data-ajax="false" href="/apex/tabletFeatured" class="hpFont tabletRow" onclick="event.stopPropagation();">
                            <h2>Featured</h2>
                        </a>
                    </li>
                    <li data-icon="false"><span class='icon-trending'></span><a data-ajax="false" href="#" class="hpFont tabletRow" onclick="event.stopPropagation(); alert('Trending is not available on tablet. Please switch to the mobile version if you\'d like to use Trending.')"><h2>Trending</h2></a></li>
                    <li data-icon="false">
                        <span class='icon-logout'></span>
                        <a id="t7" data-ajax="false" href="#" class="hpFont tabletRow" style="border-bottom-width:3px;" onclick="event.stopPropagation();">
                            <h2>Sign Out</h2>
                        </a>
                    </li>
                </ul>
                <a href="/apex/mobileLearningBoardMockup?id={!LearningBoardDtls.LBid}" onclick="event.stopPropagation();" style="position:absolute; bottom: 47px;background-color: #4a4a4a;width: 100%;text-align: center;text-decoration: none;color: white;text-shadow: none;padding: 3px 0px 3px 0px;">Switch to mobile version</a>

            </div>
            <!--panel-->      
            <div data-role="header" style="background:#767676;border:none;" data-position="fixed" data-tap-toggle="false">
                <div data-type="horizontal" data-role="controlgroup" class="ui-btn-left" style="vertical-align:middle;margin-top:17px;"> 
                    <a href="#" onclick="window.history.back()" data-role="none" data-ajax="false" id="buttonMenu"><img src="{!URLFOR($Resource.iconassets, 'icons/back_icon.png')}" id="menuImage" style="height:30px;"/></a>
                </div>
                <h1 style="color: #fff; font-weight:normal;"><img src="{!URLFOR($Resource.mslp_pic, 'pic/9.png')}" style="width: 36px;" />insight</h1>
                <div data-type="horizontal" data-role="controlgroup" class="ui-btn-right" style="margin-top:17px;">  
                    <a href="#pnl" data-role="none" data-ajax="false" id="buttonSearch"><img src="{!URLFOR($Resource.iconassets, 'icons/Icon_Search.png')}" id="searchImage"/></a> 
                </div>
            </div>
            <div data-role="content" class="ui-content">
                <div class="titleHeader">
                    <h1>{!LearningBoardDtls.LBName}</h1>
                </div>
                <div id="mainContent" style="margin-top:50px; background-color:#5e5e5e;">
                    <apex:outputPanel rendered="{!!LearningBoardDtls.StaticImage}"> 
                        <img src="{!URLFOR($Action.Attachment.Download, LearningBoardDtls.AttachmentId)}" width="100" height="auto" style="display: block; max-height:450px; min-width: 100%; min-height:185px; max-width:100%; max-height:200px;" />
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!LearningBoardDtls.StaticImage}">
                        <img src="{!LearningBoardDtls.DefaultImageName}" width="100" height="auto" style="display: block; max-height:450px; min-width: 100%; min-height:185px; max-width:100%; max-height:200px;"/>
                    </apex:outputPanel>
                    <div id="masterContainer" style="margin:1em;">
                        <div id="nameBar" style="width: 100%; height: 45px; overflow: hidden; display:flex;">
                            <!--<a href="#" id="open-popupArrow" class="clickable-area"><img src="{!LearningBoardOwnerDtls.FullPhotoUrl}" class="communityOwnerImg"/></a>
                                <p style="display: inline; padding: 0; margin: 0; padding-left: 7px; padding-top:9px; color:white; text-shadow:none;">{!LearningBoardOwnerDtls.Name}</p>
                            -->
<div data-role="popup" id="popupArrow" data-arrow="true" data-overlay-theme="b" data-theme="b">
<style>
.ui-popup>span {
    margin:0;
    margin-right:4px;
    float:left;
}
</style>
<apex:outputPanel rendered="{!!isloggedUser}">
    <apex:outputPanel rendered="{!!IsFollowOwner}">
        <a href="#" onclick="performFollowAction()">Follow </a>                  
    </apex:outputPanel>
    <apex:outputPanel rendered="{!IsFollowOwner}">
        <a href="#" onclick="performUnfollowAction()">Unfollow </a>                  
    </apex:outputPanel>
</apex:outputPanel>


<a href="#" data-rel="back" onclick="showMemberDetails('{!LearningBoardOwnerDtls.id}')">View Profile</a>
</div>
<a href="#" id="open-popupArrow" class="clickable-area"><img src="{!LearningBoardOwnerDtls.FullPhotoUrl}" class="communityOwnerImg"/></a>
<p style="display: inline; padding: 0; margin: 0; padding-left: 7px; padding-top:9px; color:white; text-shadow:none;">{!LearningBoardOwnerDtls.Name}</p>
<div style="visibility:invisible;width:0px;height:0px; display:none;">
<apex:form styleClass="EfollowForm" >
<apex:outputPanel rendered="{!!isloggedUser}">
<apex:inputhidden id="hdnOperatingSystem" value="{!OperatingSystem}"/>
<apex:inputhidden id="hdnBrowser" value="{!Browser}"/>
<apex:inputhidden id="hdnUserName" value="{!UserName}"/>
<apex:inputhidden id="hdnDeviceType" value="{!DeviceType}"/>

<apex:commandButton id="CommandButton1" value="Follow" styleclass="btnAthena btn-primary shareBtn m14 followBtn"  action="{!followOwner}" rendered="{!!IsFollowOwner}" style="display:none !important;visibility:invisible;"/>
<apex:commandButton id="CommandButton2" value="Unfollow" styleclass="btnAthena btn-primary shareBtn m14 followBtn"  action="{!unfollowOwner}" rendered="{!IsFollowOwner}" style="display:none !important;visibility:invisible;"/>
</apex:outputPanel>
</apex:form>
</div>

<script>
$.mobile.document.on( "click", "#open-popupArrow", function( evt ) {
    $( "#popupArrow" ).popup( "open", { x: evt.pageX, y: evt.pageY } );
    evt.preventDefault();
});
</script>
<style>
.clickable-area {
    display: block;
    /*width: 100%;*/
}
.clickable-area:focus {
    outline: 0;
}
</style>         

                        </div>
                        <div id="boardDesc" style="width: 100%; max-height: 100px; overflow: hidden; padding: 4px 0px 4px 0px;">
                            <p style="color:white; text-shadow:none; font-size:11pt; margin:0;">{!LearningBoardDtls.LBDescription}</p>
                        </div>
                        <div id="actionBar" style="width: 100%; max-height: 45px; overflow: hidden;">
                            <apex:outputPanel rendered="{!!IsOwnerOrContributor}">
                                <apex:outputPanel rendered="{!IsMember}"> <a class="ui-btn" style="max-height: 35px; font-size: 10pt; background-color: #0894D2; color: white; text-shadow: none; border: none; float:left; border-top-right-radius:4px 4px; border-bottom-left-radius:4px 4px;" onclick="joinBoard(false)">Leave</a> </apex:outputPanel>
                                <apex:outputPanel rendered="{!!IsMember}"> <a href="#" class="ui-btn" style="max-height: 35px; width: 30px; font-size: 10pt; background-color: #0894D2; color: white; text-shadow: none; border: none; float:left; border-top-right-radius:4px 4px; border-bottom-left-radius:4px 4px;" onclick="joinBoard(true)">Join</a> </apex:outputPanel>
                            </apex:outputPanel>
                            <div id="shareContain" style="float:right; z-index:1000;">
                                <!-- START SHARE PANEL -->
                                <style>
                                    #sharePanel {
                                    background-color:#F3F3F3;
                                    }
                                    #sharePanel .ui-panel-inner {
                                    padding: 10px !important;
                                    }
                                    #sharePanel h1 {
                                    display:block;
                                    width:230px;
                                    }
                                    #sharePanel h2 {
                                    display:block;
                                    font-size: 13px;
                                    padding-bottom: 20px;
                                    }
                                </style>
                                <script>
                                    function changePage(index) {
                                      var hTree = $('#contacts').controlgroup("container").children();
                                      var indices = [];
                                      for (var v =0; v < hTree.length; v++) {
                                          console.log( v + ' ' + $( hTree[v] ).text() + ': ' + $( hTree[v] ).hasClass('sResult') );
                                          if ( $( hTree[v] ).hasClass('sResult') ) {
                                              indices.push(v);
                                          }
                                      }
                                      
                                      var lstLen = indices.length;
                                      if ( lstLen <= 0 ) {
                                          lstLen = hTree.length;
                                      }
                                      var numOfTabs = Math.ceil( lstLen / 5 );
                                      console.log('num of tabs: ' + numOfTabs);
                                    
                                    
                                      if (index == -1) {    // Go Left
                                          var jmp = parseInt($('input:radio[name=radio-choice-h-6]:checked').attr('id')) - 1;
                                          if (jmp >= 1) {
                                              changePage(jmp);
                                              $('#'+jmp).attr("checked",true).checkboxradio("refresh");
                                              $('#'+(jmp+1)).attr("checked",false).checkboxradio("refresh");
                                              
                                                              var nextBox = parseInt($('input:radio[name=radio-choice-h-6]:checked').attr('id')) + 1;
                                              if (nextBox > 5) {
                                                  nextBox = 0;
                                              }
                                    
                                              var prevBox = parseInt($('input:radio[name=radio-choice-h-6]:checked').attr('id')) - 1;
                                              if (prevBox < 0) {
                                                  prevBox = 0;
                                              }
                                                                              
                                              if ($('#'+(nextBox)).css('display') == 'none') {
                                                  $('#'+(nextBox)).css('display','');
                                                  $('#l_'+(nextBox)).css('display','');
                                                  $('#'+(nextBox-3)).css('display','none');
                                                  $('#l_'+(nextBox-3)).css('display','none');
                                              }
                                              
                                              if ($('#'+(prevBox)).css('display') == 'none') {
                                                  $('#'+(prevBox)).css('display','');
                                                  $('#l_'+(prevBox)).css('display','');
                                                  $('#'+(prevBox+3)).css('display','none');
                                                  $('#l_'+(prevBox+3)).css('display','none');
                                              }
                                          }
                                          return;            
                                      }
                                      else if (index == -2) {    // Go Right
                                          var jmp = parseInt($('input:radio[name=radio-choice-h-6]:checked').attr('id')) + 1;
                                          if (jmp >= 1 && jmp <= numOfTabs) {
                                              changePage(jmp);
                                              $('#'+jmp).attr("checked",true).checkboxradio("refresh");
                                              $('#'+(jmp-1)).attr("checked",false).checkboxradio("refresh");
                                              
                                              var nextBox = parseInt($('input:radio[name=radio-choice-h-6]:checked').attr('id')) + 1;
                                              if (nextBox > 5) {
                                                  nextBox = 0;
                                              }
                                    
                                              var prevBox = parseInt($('input:radio[name=radio-choice-h-6]:checked').attr('id')) - 1;
                                              if (prevBox < 0) {
                                                  prevBox = 0;
                                              }
                                                                              
                                              if ($('#'+(nextBox)).css('display') == 'none') {
                                                  $('#'+(nextBox)).css('display','');
                                                  $('#l_'+(nextBox)).css('display','');
                                                  $('#'+(nextBox-3)).css('display','none');
                                                  $('#l_'+(nextBox-3)).css('display','none');
                                              }
                                              
                                              if ($('#'+(prevBox)).css('display') == 'none') {
                                                  $('#'+(prevBox)).css('display','');
                                                  $('#l_'+(prevBox)).css('display','');
                                                  $('#'+(prevBox+3)).css('display','none');
                                                  $('#l_'+(prevBox+3)).css('display','none');
                                              }
                                    
                                          }
                                          return;
                                      }
                                    
                                      index--;
                                      
                                      /*var rsPage = 5;    // number of results per page
                                      var start = index * rsPage;
                                      var end = Math.min((start + rsPage) - 1, hTree.length - 1);
                                      //console.log('(' + start + ', ' + end + ')');
                                      
                                      for (var v=0; v < hTree.length; v++) {
                                          if ((v >= start) && (v <= end)) {
                                              $( hTree[v] ).css('display','');
                                          }
                                          else {
                                              $( hTree[v] ).css('display','none');
                                          }
                                      }*/     
                                                   
                                      
                                      
                                      if ( indices.length == 0 ) {
                                          for ( var d =0; d <= hTree.length; d++ ) {
                                              indices.push(d);
                                          }   
                                      }
                                      
                                      var rsPage = 5;    // number of results per page
                                      var start = index * rsPage;
                                      var end = Math.min((start + rsPage) - 1, indices.length - 1);
                                      console.log('(' + start + ', ' + end + ')');
                                    
                                      for (var v=0; v < indices.length; v++) {
                                          if ((v >= start) && (v <= end)) {
                                              $( hTree[indices[v]] ).css('display','');
                                          }
                                          else {
                                              $( hTree[indices[v]] ).css('display','none');
                                          }
                                      }
                                      
                                                      
                                      $("#contacts")
                                      .enhanceWithin()
                                      .controlgroup("refresh");
                                      
                                    }
                                    
                                    function createPagination(nTabs) {
                                    
                                    if ( nTabs <= 1 ) {
                                        $('#pages').css('display','none');
                                        return;
                                    }
                                    else {
                                        $('#pages').css('display','');
                                    }
                                    
                                    $('#pages')
                                          .controlgroup("container")
                                          .html('');
                                          
                                      var maxTabs = 3;
                                      $('#pages')
                                          .controlgroup("container")
                                          .append('<a href="#" class="ui-btn ui-corner-all ui-icon-arrow-l ui-btn-icon-left" style="background-color:white; border-color:lightgrey;" onclick="changePage(-1)">&nbsp;</a>');
                                          
                                          for(var i = 1; i <= nTabs; i++) {
                                              if ( i==1 ) {
                                                  $('#pages')
                                                  .controlgroup("container")
                                                  .append('<input type="radio" name="radio-choice-h-6" id="'+ i +'" value="on" checked="checked" onclick="changePage('+ i +')"><label for="'+ i +'" id="l_'+ i +'" class="normalTab">' + i + '</label>');
                                              }
                                              else {
                                                  if (i > maxTabs) {
                                                    $('#pages')
                                                      .controlgroup("container")
                                                      .append('<input type="radio" name="radio-choice-h-6" id="'+ i +'" onclick="changePage('+ i +')" style="display:none;"><label for="'+ i +'" id="l_'+ i +'" style="display:none;" class="normalTab">' + i + '</label>');                    
                                                  }
                                                  else {
                                                      $('#pages')
                                                      .controlgroup("container")
                                                      .append('<input type="radio" name="radio-choice-h-6" id="'+ i +'" onclick="changePage('+ i +')"><label for="'+ i +'" id="l_'+ i +'" class="normalTab">' + i + '</label>');
                                                  }
                                              }                
                                          }
                                          
                                          $('#pages')
                                          .controlgroup("container")
                                          .append('<a href="#" class="ui-btn ui-corner-all ui-icon-arrow-r ui-btn-icon-right" style="background-color:white; border-color:lightgrey;" onclick="changePage(-2)">&nbsp;</a>');
                                          
                                          $("#pages")
                                          .enhanceWithin()
                                          .controlgroup("refresh");
                                          
                                          $("input[type='radio']").bind( "change", function(event, ui) {
                                              var nextBox = parseInt($('input:radio[name=radio-choice-h-6]:checked').attr('id')) + 1;
                                              if (nextBox > 5) {
                                                  nextBox = 0;
                                              }
                                    
                                              var prevBox = parseInt($('input:radio[name=radio-choice-h-6]:checked').attr('id')) - 1;
                                              if (prevBox < 0) {
                                                  prevBox = 0;
                                              }
                                                                              
                                              if ($('#'+(nextBox)).css('display') == 'none') {
                                                  $('#'+(nextBox)).css('display','');
                                                  $('#l_'+(nextBox)).css('display','');
                                                  $('#'+(nextBox-3)).css('display','none');
                                                  $('#l_'+(nextBox-3)).css('display','none');
                                              }
                                              
                                              if ($('#'+(prevBox)).css('display') == 'none') {
                                                  $('#'+(prevBox)).css('display','');
                                                  $('#l_'+(prevBox)).css('display','');
                                                  $('#'+(prevBox+3)).css('display','none');
                                                  $('#l_'+(prevBox+3)).css('display','none');
                                              }
                                    
                                          });
                                    
                                          
                                          changePage(1);
                                     }
                                          
                                    function shareLearningBoard(topicName, topicId) {       
                                      $('#topicTitle').text(topicName);
                                      window.tId = topicId;
                                      
                                      $('#contacts').controlgroup("container").html('');
                                      Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.AthenaLearningBoardDtls.GetNetworkUsersList}', "{!LearningBoardDtls.LbId}", ShowNetworkUsers);    
                                    }
                                          
                                    function ShowNetworkUsers(result, event) {
                                          for(var i = 0; i < result.length; i++) {
                                              $('#contacts')
                                              .controlgroup("container")
                                              .append('<input type="checkbox" name="itemIds" id="'+ result[i].Id +'"/> <label for="'+ result[i].Id +'" style="color:#0093D1; background-color:white !important; text-shadow:none; border-color:lightgrey;">'+ result[i].Name +'</label>');           
                                          }
                                          
                                          $("#contacts")
                                          .enhanceWithin()
                                          .controlgroup("refresh");
                                          
                                          // Pagination
                                          if (result.length > 5) {                
                                              var numOfTabs = Math.ceil( result.length / 5 );
                                              createPagination(numOfTabs);
                                          }
                                    }
                                    
                                    function shareContent(contentId, contentName){
                                        shareLearningBoard(contentName, contentId);
                                        $( "#sharePanel" ).popup("open");
                                    }

                                    
                                    function SaveUsers()
                                    {
                                          
                                          $("#shareButton").addClass('ui-disabled');
                                          
                                          var strRel = '';
                                          
                                           var operatingSystem='';//operatingSystem.substring(0,operatingSystem.indexOf("\)")+1);
                                           $('[id$=hdnShareOperatingSystem]').val('');
                                           $('[id$=hdnShareBrowser]').val('');
                                           $('[id$=hdnShareDeviceType]').val('Mobile');
                                          
                                          var lst = $('#contacts').closest('fieldset').find(':checkbox');
                                          
                                          for (var i=0; i<lst.length; i++) {
                                              if ($("#" + lst[i].id).prop("checked")) {
                                                  if (strRel == '') {
                                                      strRel = lst[i].id;
                                                  }
                                                  else {
                                                      strRel = strRel + ',' + lst[i].id;
                                                  }
                                              }
                                          }
                                          console.log('SaveUsers: ' + strRel );
                                    
                                        if (strRel == '')
                                        {
                                            alert('Select at least one user');
                                            $("#shareButton").removeClass('ui-disabled')
                                        }
                                        else
                                        {
                                            document.cookie = "TopicCatName=" + $('[id$=hdnContentCtgyName]').val();
                                    
                                            $('[id$=hdnShareContentFlag]').val('Y');
                                    
                                            var ShareCmt = $('#commentArea').val();
                                            var TopicId = window.tId;
                                            var topName = $('#topicTitle').text();
                                            
                                            document.getElementById("{!$Component.SlpActv1.hdnSelectedUsrsId}").value = strRel;
                                            document.getElementById("{!$Component.SlpActv1.hdnShareComment}").value = ShareCmt;
                                            document.getElementById("{!$Component.SlpActv1.hdnContentShareId}").value = TopicId;
                                            document.getElementById("{!$Component.SlpActv1.hdnShareTopicName}").value = topName;
                                            
                                            console.log(strRel + ", " + ShareCmt + ", " + TopicId + ", " + topName);
                                            var button = document.getElementById("{!$Component.SlpActv1.SActivityShare}");
                                            button.click();
                                        }
                                    }
                                    
                                    function FindBrowserVersion()
                                    {
                                    debugger
                                      var nVer = navigator.appVersion;
                                      var nAgt = navigator.userAgent;
                                      var browserName  = navigator.appName;
                                      var fullVersion  = ''+parseFloat(navigator.appVersion); 
                                      var majorVersion = parseInt(navigator.appVersion,10);
                                      var nameOffset,verOffset,ix;
                                              if ((verOffset=nAgt.indexOf("Opera"))!=-1) {
                                         browserName = "Opera";
                                         fullVersion = nAgt.substring(verOffset+6);
                                         if ((verOffset=nAgt.indexOf("Version"))!=-1) 
                                           fullVersion = nAgt.substring(verOffset+8);
                                      }
                                      // In MSIE, the true version is after "MSIE" in userAgent
                                      else if ((verOffset=nAgt.indexOf("MSIE"))!=-1) {
                                         browserName = "Microsoft Internet Explorer";
                                         fullVersion = nAgt.substring(verOffset+5);
                                      }
                                      // In Chrome, the true version is after "Chrome" 
                                      else if ((verOffset=nAgt.indexOf("Chrome"))!=-1) {
                                         browserName = "Chrome";
                                         fullVersion = nAgt.substring(verOffset+7);
                                      }
                                      // In Safari, the true version is after "Safari" or after "Version" 
                                      else if ((verOffset=nAgt.indexOf("Safari"))!=-1) {
                                         browserName = "Safari";
                                         fullVersion = nAgt.substring(verOffset+7);
                                         if ((verOffset=nAgt.indexOf("Version"))!=-1) 
                                           fullVersion = nAgt.substring(verOffset+8);
                                      }
                                      // In Firefox, the true version is after "Firefox" 
                                      else if ((verOffset=nAgt.indexOf("Firefox"))!=-1) {
                                          browserName = "Firefox";
                                          fullVersion = nAgt.substring(verOffset+8);
                                      }
                                      // In most other browsers, "name/version" is at the end of userAgent 
                                      else if ( (nameOffset=nAgt.lastIndexOf(' ')+1) < (verOffset=nAgt.lastIndexOf('/')) ) {
                                          browserName = nAgt.substring(nameOffset,verOffset);
                                          fullVersion = nAgt.substring(verOffset+1);
                                          if (browserName.toLowerCase()==browserName.toUpperCase()) {
                                             browserName = navigator.appName;
                                          }
                                      }
                                      else
                                      {
                                          browserName= nAgt;
                                          fullVersion="None";
                                      }
                                      // trim the fullVersion string at semicolon/space if present
                                      if ((ix=fullVersion.indexOf(";"))!=-1)
                                          fullVersion=fullVersion.substring(0,ix);
                                      if ((ix=fullVersion.indexOf(" "))!=-1)
                                          fullVersion=fullVersion.substring(0,ix);
                                    
                                      majorVersion = parseInt(''+fullVersion,10);
                                      if (isNaN(majorVersion)) {
                                          fullVersion  = ''+parseFloat(navigator.appVersion); 
                                          majorVersion = parseInt(navigator.appVersion,10);
                                      }
                                      var BrowserVer='';
                                      if(fullVersion=='None')
                                      {
                                        BrowserVer=browserName;
                                      }
                                      else
                                      {
                                         BrowserVer=browserName+' '+fullVersion;
                                      }
                                      return BrowserVer;
                                    } 
                                    
                                    
                                </script>
                                <div data-role="popup" id="sharePanel" data-overlay-theme="b" data-theme="b" data-dismissible="false" style="min-width:400px; max-width:600px; top:-90px;">
                                    <div role="main" style="margin:1em;">
                                        <h2 style="padding-bottom:0; color:black; text-shadow:none;">Select users from your network</h2>
                                        <h1 id="topicTitle" style="color:black; text-shadow:none;">{!LearningBoardDtls.LBName}</h1>
                                        <hr/>
                                        <fieldset data-role="controlgroup" id="contacts" data-filter="true" data-icon="false">                
                                        </fieldset>
                                        <div data-role="controlgroup" id="pages" data-type="horizontal" data-mini="true">
                                        </div>
                                        <textarea name="commentArea" id="commentArea" style="background-color:white; border-color:lightgrey; color:black; text-shadow:none;"></textarea>
                                        <div id="btnPnl" style="height:60px;">
                                            <a href="#" class="ui-btn" style="float:left; border-color:#f3f3f3; background-color:#767676; border-top-right-radius: 10px 10px;border-bottom-left-radius: 10px 10px; color: white;text-shadow: none; width:30%;" onclick="$( '#sharePanel' ).popup('close');">Cancel</a>
                                            <a href="#" id="shareButton" class="ui-btn" style="float:right; border-color:#f3f3f3; background-color:#2fade7;border-top-right-radius: 10px 10px;border-bottom-left-radius: 10px 10px;color: white;text-shadow: none; width:30%;" onclick="SaveUsers()">Share</a>
                                        </div>
                                        <apex:form style="display:none !important;" id="SlpActv1">
                                            <apex:commandButton styleclass="btnAthena btn-primary btnAthenaPopP"  style="display:none !important" action="{!SaveNetworkUsers}" value="hide" id="SActivityShare"/>
                                            <apex:inputText id="hdnShareOperatingSystem" style="display:none"  value="{!ShareOperatingSystem}"/>
                                            <apex:inputText id="hdnShareBrowser" style="display:none"  value="{!ShareBrowser}"/>
                                            <apex:inputText id="hdnShareDeviceType" style="display:none"  value="{!ShareDeviceType}"/>
                                            <apex:inputText id="hdnSelectedUsrsId" style="display:none"  value="{!SelectedUsrs}"/>
                                            <apex:inputText id="hdnShareComment" style="display:none"  value="{!hdnSharecmt}"/>
                                            <apex:inputText id="hdnContentShareId" style="display:none"  value="{!ContentShareId}"/>
                                            <apex:inputText id="hdnShareContentFlag" style="display:none"  value="{!hdnShareContentFlag}"/>
                                            <apex:inputText id="hdnShareTopicName" style="display:none"  value="{!ShareTopicName}"/>
                                        </apex:form>
                                    </div>
                                </div>
                                <!-- END SHARE PANEL --> 
                                <a href="#sharePanel" data-BoardId ="{!LearningBoardDtls.LbId}" onClick="shareBoard(this)" data-rel="popup" data-position-to="window" data-transition="pop" class="ui-btn" style="background-color:#0894D2; border-top-right-radius: 4px 4px;border-bottom-left-radius: 4px 4px; color: white;text-shadow: none; float:right; clear:both; min-height:0; padding-left:1em; padding-top:6px; padding-bottom:6px; border:none;">Share<span class="icon-share" style="font-size:16pt;text-align:center;color:#ffffff;float:right; clear:both;padding-left:6px;"></span></a>
                                <div class="column1" id="brdStars" style="float:right; padding: 10px 10px 0px 0px;"></div>
                            </div>
                        </div>
                    </div>
                    <!-- masterContainer -->
                    <div data-role="tabs" id="tabs">
                        <div data-role="navbar" id="mNavBar" style="max-width:50%; padding-top:8px;z-index:1000;">
                            <ul>
                                <li id="tab1"><a href="#contentContainer" class="ui-btn-active" data-ajax="false">Content</a></li>
                                <li id="tab2"><a href="#chatContainer" data-ajax="false">Chat</a></li>
                                <li id="tab3"><a href="#membersList" data-ajax="false">Members</a></li>
                                <li id="tab4"><a href="#relatedList" data-ajax="false">Related</a></li>
                            </ul>
                        </div>
                        <div id="contentContainer" style='background-color:#ECECEC; padding:1em; padding-top:0;'>
                            <ul data-role="listview" id="collateralList" class="listviewTopic" data-filter="true" data-filter-placeholder=" " data-inset="false"></ul>
                                                            <!-- START RATE DOCUMENT PANEL -->

    <div data-role="popup" id="ratePanel" data-overlay-theme="b" data-dismissible="false" style="min-width:400px; max-width:600px; top:-90px; background-color:#f3f3f3;">
        <div data-role="content" style="margin:1em;">
            <p>Rate this topic</p>
            <h1 id="popupDocLName">Optimize Oil Production</h1>
            <div class="hr" style="margin-bottom:20px;"><hr /></div>
            <span>
            <div style="display:table-cell;margin-top:20px;">Average rating:</div>
            <span id="popupRatingimages" style="display:table-cell;">******</span>
            </span>
            <span >
            <div style="display:table-cell;margin-top:20px;">Rated by&nbsp;</div>
            <span id="popupRatingUsers" style="display:table-cell;"> 14 users</span>
            </span>
            <div class="hr" style="margin:20px;"><hr /></div>
            <label for="ratingSlider">My rating:</label>
           <input name="ratingSlider" id="ratingSlider" type="range" min="1" max="5" value="3" data-show-value="true" style="clear:left"/>
            <div class="hr" style="margin:20px;"><hr /></div>
            <div class="ui-grid-a">
                <div class="ui-block-a"><a href="#ratePanel" data-role="button" style="background:#767676;color:#ffffff;text-shadow:none;">Not now</a></div>
                <div class="ui-block-b"><a href="#" id="rateButton" data-role="button" style="background:#F9A006;color:#ffffff;text-shadow:none;" data-mini="false" onclick="rateDocument()">Rate it</a></div>
            </div><!-- /grid-a -->
            <!-- Document information
            <div style="float: left"><img id="popupDocOwnerPhoto" src="{!CommunityOwnerDetails.FullPhotoUrl}" class="communityOwnerImg"/></div>
            <div id="popupDocLName">Unknown name</div>
            <div id="popupDocLOwnerName" style="font-weight:bold;">Unknown owner</div>
            <div style="clear:both"></div>
            <div id="popupDocLDescription" style="white-space: normal;">No description</div> -->
            <!-- Create SF form as hidden as a proxy to interact with SF when submitting rating -->
                    <div style="visibility:hidden; height:0px">
                        <apex:form id="SFRatingForm">
                            <apex:inputHidden id="txtCommunityTopicID" value="{!LearningBoardTopicID}" />
                            <apex:inputHidden id="txtOwnerContributor" value="{!IsOwnerOrContributor}" />
                            <apex:outputLabel value="Your Rating" for="txtTopicScore"/>                 
                            <apex:selectList id="txtTopicScore" value="{!UserTopicRating}" size="1">
                                <apex:selectOption itemValue="1" itemLabel="1"/>
                                <apex:selectOption itemValue="2" itemLabel="2"/>
                                <apex:selectOption itemValue="3" itemLabel="3"/>
                                <apex:selectOption itemValue="4" itemLabel="4"/>
                                <apex:selectOption itemValue="5" itemLabel="5"/>
                            </apex:selectList>
                            <apex:outputLabel value="Rating comment (optional)" for="txtUserTopicRatingComment"/>                   
                            <apex:inputTextarea id="txtUserTopicRatingComment"  rows="3" value="{!userTopicRatingComment}" title="Rating Comment"/>
                            <apex:commandButton id="btnUserRating" action="{!SaveTopicUserRating}" value="Rate It!" >
                            </apex:commandButton>
                        </apex:form>
                    </div>

    </div><!-- /panel -->
</div>
<!-- END RATE DOCUMENT PANEL --> 

                        </div>
                        <!-- contentContainer -->
                        <div id="chatContainer" style='background-color:#ECECEC; padding:1em; padding-top:0;'>
                            <!-- Code for chatter feed - Begin -->
                            <div align="center" style="background-color:transparent !important;white-space:wrap !important;border:none !important;">
                                <fieldset class="ui-grid-a" align="center">
                                    <div class="ui-block-a" style="width:70%"><input type="text" placeholder="Enter your comment..." name="fnameComment" id="fnameComment2" data-clear-btn="true" data-mini="false" data-corners="false"/></div>
                                    <div class="ui-block-b" style="width:30%;" align="center"><a href="#" id="commentButton" data-role="button" style="background: #F9A006; color:#ffffff;margin-top:9px; text-shadow:none; border:none;" data-mini="true" onclick="postComment()">Post</a></div>
                                </fieldset>
                                <div style="visibility:hidden; height:0px">
                                    <apex:form id="frmPostInputComment2" onsubmit="return isPopulated('fnameComment2');">
                                        <fieldset class="ui-grid-a">
                                            <div class="ui-block-a" style="width:70%">
                                                <apex:inputText id="txtPostInputComment2" value="{!feedItemInputText}" html-placeholder="Enter your reply here..." style="min-height: 2.8em"/>
                                            </div>
                                            <div class="ui-block-b" style="width:30%">
                                                <apex:commandButton id="cmdBtnPostComment2" rerender="feedOutputPanel" action="{!postNewFeedItemLBTablet}" value="Post"/>
                                            </div>
                                        </fieldset>
                                        <div style="visibility:hidden; height:0px">
                                            <apex:inputTextarea id="txtUserTopicCommentC" value="{!feedCommentID}" title="Comment"/>
                                        </div>
                                    </apex:form>
                                </div>
                            </div>
                            <div id="spacer" style="height:20px;"></div>
                            <ul id="chatterList" data-role="listview" data-inset="false" style="transparent !important;white-space:wrap !important;border:none !important; padding:1em;">
                                <apex:repeat value="{!feedItemPage.items}" var="feedItem">
                                    <li data-icon="false" class="actvitylist" style="background:white !important; margin-top:10px; border-radius: 4px; border-color:#969696; border-width: 1px; box-shadow:3px 3px 8px #CACACA;" id="foo">
                                        <img src="{!feedItem.photoUrl}" class="circular" style="margin-left: 3em; margin-top: 1em;"/>
                                        <h2 class="hpFont" style="background:transparent;text-align:left;color:#38c;text-shadow:none; height:auto; line-height:1; min-height:0 !important;">{!feedItem.actor.name}</h2>
                                        <span class="ctrl hpFont" style="text-align:left;">
                                            <fieldset data-role="controlgroup" data-type="horizontal" data-mini="true" style="padding-right:15px;">
                                                <apex:outputText value="{0, date, dd MMM yy}" rendered="{!NOT(ISNULL(feedItem.createdDate))}">
                                                    <apex:param value="{!feedItem.CreatedDate}" />
                                                </apex:outputText>
                                            </fieldset>
                                        </span>
                                        <p id="postedText" class="hpFont" style="background:transparent;text-align:left;color:black;text-shadow:none;white-space:normal!important;word-wrap: break-word!important;word-break: break-word!important; margin-left:-50px; font-size:11pt;">{!feedItem.body.text}</p>
                                        <p style="background-color:transparent; margin-left:-50px; margin-bottom:-14px !important;"><a href="#" id="comment_{!feedItem.id}" onClick=" $( '#input_{!feedItem.id}' ).css('display',''); $(this).css('display','none'); " style="background-color:transparent !important; text-decoration:none; display:none;">Comment</a></p>
                                        <div id="input_{!feedItem.id}" style="display:none; margin-left:-50px; padding-top:10px;">
                                            <input type="text" name="replyText_{!feedItem.id}" id="replyText_{!feedItem.id}" value=""></input>
                                            <a href="#" class="ui-btn" style="float:right; background-color:#2fade7 !important ;border-top-right-radius: 10px 10px;border-bottom-left-radius: 10px 10px;color: white;text-shadow: none; width:60px; margin-left:10px; border-color:white !important;" onClick="postReply('#replyText_{!feedItem.id}', '{!feedItem.id}')">Post</a>
                                            <a href="#" class="ui-btn" style="float:right; background-color:#2fade7;border-top-right-radius: 10px 10px;border-bottom-left-radius: 10px 10px;color: white;text-shadow: none; width:60px; border-color:white !important;" onclick=" $( '#input_{!feedItem.id}' ).css('display','none'); $( '#comment_{!feedItem.id}' ).css('display',''); ">Cancel</a>
                                            <div style="visibility:hidden; height:0px">
                                                <apex:form id="frmPostInput2" onsubmit="return isPopulated('txtPostInput2');">
                                                    <fieldset class="ui-grid-a">
                                                        <div class="ui-block-a" style="width:70%">
                                                            <apex:inputText id="txtPostInput2" value="{!feedItemInputText}" html-placeholder="Enter your reply here..." style="min-height: 2.8em"/>
                                                        </div>
                                                        <div class="ui-block-b" style="width:30%">
                                                            <apex:commandButton id="cmdBtnPost26" rerender="feedOutputPanel" action="{!postNewCommentTablet}" value="Post"/>
                                                        </div>
                                                    </fieldset>
                                                    <div style="visibility:hidden; height:0px">
                                                        <apex:inputTextarea id="txtUserTopicComment" value="{!feedCommentID}" title="Comment"></apex:inputTextArea>
                                                    </div>
                                                </apex:form>
                                            </div>
                                        </div>
                                        <div>
                                            <span>
                                                <ul data-role="listview" data-inset="true" style="box-shadow: 0 0px 0px rgba(0,0,0,0) !Important; background-color:#FBFBFB !important;border:none !important;">
                                                    <apex:repeat value="{!feedItem.comments.comments}" var="comment">
                                                        <li style="margin-left:-15px; margin-right:15px; background:transparent !important; border:none !important;">
                                                            <img src="{!comment.user.photo.smallPhotoUrl}" class="circular" style="margin-left: 3em; margin-top: 1em;"/>
                                                            <h2 class="hpFont" style="background:transparent;text-align:left;color:#38c;text-shadow:none; height:auto; line-height:1; min-height:0 !important;">{!comment.user.firstname} {!comment.user.lastname}</h2>
                                                            <span class="ctrl hpFont" style="text-align:left">
                                                                <fieldset data-role="controlgroup" data-type="horizontal" data-mini="true" >
                                                                    <apex:outputText value=" {0, date, dd MMM yy}" rendered="{!NOT(ISNULL(comment.createdDate))}">
                                                                        <apex:param value="{!comment.CreatedDate}" />
                                                                    </apex:outputText>
                                                                </fieldset>
                                                            </span>
                                                            <p id="postedText"  class="hpFont" style="background:transparent;text-align:left;color:black;text-shadow:none;white-space:normal!important; margin-left:-50px; font-size:11pt;">
                                                                <apex:repeat value="{!comment.body.messageSegments}" var="segment">
                                                                    {!segment.text}
                                                                </apex:repeat>
                                                            </p>
                                                        </li>
                                                    </apex:repeat>
                                                </ul>
                                            </span>
                                        </div>
                                    </li>
                                </apex:repeat>
                            </ul>
                            <!-- Code for chatter feed - End -->                            
                        </div>
                        <div id="membersList" style="background-color:#ECECEC">
                            <div id="custom-collapsible" class="my-page" style="margin-top:7px;">
                        <div style="width:100%; display:inline-block;">
                        <div data-role="navbar" id="gNav" style="">
                            <ul>
                                <li id="taba"><a href="#" class="ui-btn-active" data-ajax="false" onClick="buildMembersList('UserName')">A-Z</a></li>
                                <li id="tabb"><a href="#" data-ajax="false" onClick="buildMembersList('RoleName')">Role</a></li>
                                <li id="tabc"><a href="#" data-ajax="false" onClick="buildMembersList('Region')">Region</a></li>
                                <li id="tabd"><a href="#" data-ajax="false" onClick="buildMembersList('BusinessGroup')">Business Group</a></li>
                            </ul>
                        </div>
                        </div>

                                <ul id="featuredList" data-role="listview" data-inset="false" style="margin:1em;">
                                </ul>
                            </div>
                            <div data-role="popup" id="memberPanel" data-overlay-theme="b" data-theme="b" data-dismissible="true" style="max-width:400px; min-width:400px; background-color:#f3f3f3">
                                <div role="main" style="margin:1em;">
                                    <div id="memberPanelMain"></div>
                                </div>
                            </div>
                        </div>
                        <div id="relatedList">
                            <div id="custom-collapsible" class="my-page" style="margin-top:7px;">
                                <ul id="featuredList1" data-role="listview" data-inset="false" style="margin:1em; padding:2em; padding-top:0;">
                                    <apex:repeat id="featuredList" value="{!GetRelatedCommunities}" var="brdRslt">
                                        <li>
                                            <a href="/apex/mobileCommunityMockup?id={!brdRslt.CommunityId}" data-ajax="false">
                                                <!--<img src="{!URLFOR($Action.Attachment.Download, brdRslt.AttachmentId)}" class="ui-li-thumb"/> -->
                                                <img>
                                                <apex:outputPanel rendered="{!!brdRslt.StaticImage}"> 
                                                    <img src="{!URLFOR($Action.Attachment.Download, brdRslt.AttachmentId)}" class="ui-li-thumb"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!brdRslt.StaticImage}">
                                                    <img src="{!brdRslt.DefaultImageName}"  class="ui-li-thumb"/>
                                                </apex:outputPanel>
                                                </img>
                                                <h2>{!brdRslt.CommunityName}</h2>
                                                <span style="position: absolute; top:0; left:0;background-color:#8CC520;width:100%;height:5px;"></span>
                                            </a>
                                        </li>
                                    </apex:repeat>
                                </ul>
                            </div>
                            <div id="custom-collapsible" class="my-page">
                                <ul id="featuredList2" data-role="listview" data-inset="false" style="margin:1em; padding:2em; padding-top:0;">
                                    <apex:repeat id="featuredListLB" value="{!RelatedLearningBoards}" var="brdRslt">
                                        <li>
                                            <a href="/apex/tabletViewBoard?id={!brdRslt.Lbid}" data-ajax="false">
                                                <!--<img src="{!URLFOR($Action.Attachment.Download, brdRslt.AttachmentId)}" class="ui-li-thumb"/>-->
                                                    <apex:outputPanel rendered="{!!brdRslt.StaticImage}"> 
                                                        <img src="{!URLFOR($Action.Attachment.Download, brdRslt.AttachmentId)}" class="ui-li-thumb"/>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!brdRslt.StaticImage}">
                                                        <img src="{!brdRslt.DefaultImageName}"  class="ui-li-thumb"/>
                                                    </apex:outputPanel>
                                                <h2>{!brdRslt.LBName}</h2>
                                                <span style="position: absolute; top:0; left:0;background-color:#165676;width:100%;height:5px;"></span>
                                            </a>
                                        </li>
                                    </apex:repeat>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- mainContent -->
            </div>
            <!-- content-->
        </div>
        <!-- page-->
        <apex:form style="display:none;">
            <div class="modal-footer">
                <input type="button" class="btnAthena" data-dismiss="modal" aria-hidden="true" value="No" />
                <apex:commandButton styleclass="btnAthena btn-primary" action="{!LeaveCommunity}" value="Yes" id="leaveBtn"/>
                <apex:commandlink styleClass="btnAthena btn-primary" value="Join" action="{!JoinBoard}" onclick="SetBrowserInfo(this);" id="joinBtn"></apex:commandlink>
                <apex:inputText id="jhdnShareOperatingSystem" style="display:none"  value="{!ShareOperatingSystem}"/>
                <apex:inputText id="jhdnShareBrowser" style="display:none"  value="{!ShareBrowser}"/>
                <apex:inputText id="jhdnShareDeviceType" style="display:none"  value="{!ShareDeviceType}"/>
            </div>
        </apex:form>
    </body>
    <script>
        function shareBoard(data){
            console.log('share board');
            $('#contacts').controlgroup("container").html('');
            $('#topicTitle').text($(data).attr('data-BoardName'));
            //$( "#sharePanel" ).panel( "open" , "");
            var LearningBoardID = $(data).attr('data-BoardId');
            window.tId = '';
            Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.AthenaLearningBoardDtls.GetNetworkUsersList}', LearningBoardID, ShowNetworkUsers);    
            $('#sharePanel').popup('reposition', 'positionTo: window');
        
        }
        
        function SetBrowserInfo()
        {
            var operatingSystem=navigator.appVersion;
            operatingSystem=operatingSystem.substring(0,operatingSystem.indexOf("\)")+1);
            
            $('[id$=jhdnShareOperatingSystem]').val('');
            $('[id$=jhdnShareBrowser]').val('');
            $('[id$=jhdnShareDeviceType]').val('Tablet');
            return true;
        }
        
        function joinBoard(isJoin) {
            if (isJoin) {
                $( '[id$=joinBtn]' ).click();
            }
            else {
                $( '[id$=leaveBtn]' ).click();
            }
        }
        
        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
            return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }
        
        function fixDiv() {
            var $cache = $('#shareContain'); 
            if ($(window).scrollTop() >= 374) 
            $cache.css({'position': 'fixed', 'top': '64px', 'right':'1em'}); 
            else
            $cache.css({'position': 'relative', 'top': 'auto', 'right':'0'});
        }
        
        function fixMenu() {
            var $cache = $('#mNavBar'); 
            console.log($(window).scrollTop());
            if ($(window).scrollTop() >= 374) 
            $cache.css({'position': 'fixed', 'top': '124px', 'left':'60px', 'width':'100%'}); 
            else
            $cache.css({'position': 'relative', 'top': 'auto', 'right':'0'});
        }
        
        function highlightTab(aTab) {
            console.log(aTab);
            $( '#' + aTab ).addClass('tabletRowHiglighteda');
            $( '#' + aTab ).parent().addClass('tabletRowHighlighedli');

        }
        
        $( document ).ready(function() {
            $( "#pnl" ).panel( "open");
            $( '#brdStars' ).append(renderRating({!UserBoardRating}));
            var LearningBoardId = getParameterByName('id'); // Id of current community
            var highTab = getParameterByName('tab');
            
            LoadCommunity(LearningBoardId, ''); 
            highlightTab(highTab);
            
            $(window).scroll(fixDiv);
            fixDiv();
            buildMembersList();
            
            if ( $( '#featuredList li' ).length <= 0 ) {
                hideEmptyTabs('#tab3');
            }
            if ( $( '#featuredList1 li' ).length <= 0 && $( '#featuredList2 li' ).length <= 0) {
                hideEmptyTabs('#tab4');
            }

            
            window.domainSP = 'prime31.sharepoint.hp.com';
            window.domainWWS = 'ensv.hp.com';
            window.domainSP2013 = 'ea2013.sharepoint.hp.com';
            window.domainEXO = 'it-services-gw-itg.external.hp.com';
            window.domainIntranet = 'intranet.hp.com';
            
            var isBoardPulic = false;
            var isOwnerOrContributor = false;
            var isMember = false;

            if ('{!IsBoardPublic}' == 'true') {
                isBoardPulic = true;
            }
            else if ('{!IsBoardPublic}' == 'false') {
                isBoardPulic = false;
            }

            if ('{!IsOwnerOrContributor}' == 'true') {
                isOwnerOrContributor = true;
            }
            else if ('{!IsOwnerOrContributor}' == 'false') {
                isOwnerOrContributor = false;
            }

            if ('{!IsMember}' == 'true') {
                isMember = true;
            }
            else if ('{!IsMember}' == 'false') {
                isMember = false;
            }

            console.log(isBoardPulic + ', ' + isOwnerOrContributor  + ', ' + isMember );
            if (isBoardPulic == true || isOwnerOrContributor == true || isMember == true) {
                // do nothing                
            }
            else if (isBoardPulic == false || isOwnerOrContributor == false || isMember == false) { 
                $( '#contentContainer' ).empty().append('<br><h3 style="margin-top:10px;">You must be a member to view the content of this board.</h3>');
                $( '#chatContainer' ).empty().append('<br><h3>You must be a member to view the chat feed of this board.</h3>');
                $( '#relatedList' ).empty().append('<br><h3 style="padding-left:1em;">You must be a member to view the related boards and communities of this board.</h3>');

            }

        });
        
         function hideEmptyTabs( divName ) {
             // collateralList - content listview
             // chatterList - chat
             // membersList
             // featuredList featuredList2
             
            $( divName ).remove();
            $('#mNavBar').navbar();                       
         }

        
        function closePanel() {
            $( "#pnl" ).panel( "close");
            $( "#pnl li a h2" ).css('display','none');
            $( "#uname" ).css('display','none');
            $( ".ui-content" ).css('margin-left','90px');
        }
        
        function openPanel() {
            $( "#pnl" ).panel( "open");
            $( "#pnl li a h2" ).css('display','block');
            $( "#uname" ).css('display','block');
            //$( ".ui-content" ).css('margin-left','270px');
        }
        
        function togglePanel() {
            if( $("#pnl").hasClass("ui-panel-open") == true )
            {
               closePanel();
            }
            else
            {
               openPanel();
            }
        }
        
        $('#listviewmenu a').click( function() {
            $('#listviewmenu li a').removeClass('tabletRowHiglighteda').addClass('tabletRow');
            $('#listviewmenu li a').parent().removeClass('tabletRowHighlighedli');
        
            $(this).parent().addClass('tabletRowHighlighedli');
            $(this).removeClass('tabletRow').addClass('tabletRowHiglighteda');
        });                
        
        function renderRating(avgRating) {
           // Used to display rating stars
           var myStarOff = "{!URLFOR($Resource.iconassets, 'icons/Icon_RatingStar-UnRated.png')}";
           var myStarOn = "{!URLFOR($Resource.iconassets, 'icons/Icon_RatingStar-Rated.png')}";
           var myStarHalf = "{!URLFOR($Resource.iconassets, 'icons/Icon_RatingStar-Half.png')}";
        
           var ratingStarImgs = "";
            for (var i=1; i<=5; i++) {
                if (i <= avgRating) {  
                    ratingStarImgs += '<span class="icon-star" style="color:#ffd31a !important; font-size:15pt;"></span>'; 
                } else if ((i - avgRating) <= 0.5){
                    ratingStarImgs += '<span class="icon-star-half-empty" style="color:#ffd31a !important; font-size:15pt;"></span>'; 
                } else {
                    ratingStarImgs += '<span class="icon-star" style="color:#cecece !important; font-size:15pt;"></span>'; 
                }
            }
            return ratingStarImgs;
        }
        
         function LoadCommunity(LearningBoardId, docId) {
            
            $.mobile.loading( "show", {
                text: "",
                textVisible: false,
                textOnly: false
            } ); // Displays load spinner while loading
            
            var APEXAction = '{!$RemoteAction.AthenaLearningBoardDtls.getLrngWithCat}';
           // Call existing APEX controller action to get data about community
            Visualforce.remoting.Manager.invokeAction(
                APEXAction,
                LearningBoardId,
                function(result, event) { // callback function receiving result of call with list of category and collaterals
                    $.mobile.loading( "hide"); // Hide load spinner after load is complete
                    
                    if (result.length <= 0) {
                        //hideEmptyTabs('#tab1');
                        $( '#noContentMsg' ).css('display','block');
                        $( '.ui-filterable' ).css('display','none');
                    }
                    
                    // Iterate through the list of all categories returned
                    for (var catCount = 0; catCount < result.length; catCount++) {
                        var currentCat = result[catCount];
                        if (currentCat.lstlrngs.length > 0) {
                            $("#collateralList").append('<li data-role="list-divider" class="listDivide">' + currentCat.CategoryName + '</li>');
                        }
                        
                        if (currentCat) {
                            // Prepare display of content of each category as a list of collapsible content
                            var catContent = "";
                            var focusOnCat = false; // Will set to true in category contains a document we need to focus on
                            if (currentCat.lstlrngs && currentCat.lstlrngs.length > 0) {
                                for (var docCount = 0; docCount < currentCat.lstlrngs.length; docCount++) {
                                    // For each collateral, add it to the list
                                    var currentDoc = result[catCount].lstlrngs[docCount];
                                    if (currentDoc) {
                                        catContent += renderDoc(currentDoc);
                                        // If this is a document we have to focus on, remember it
                                        if (currentDoc.Lid === docId) {
                                            focusOnCat = true;
                                        }
                                    }
                                }
                                // Display Category
                               
                                $("#collateralList").append(catContent);
                                $( "#collateralList" ).listview( "refresh" );
        
                            }
                        }
                    }
                    $("#collateralList").collapsibleset().trigger("create");
                    
                    if (docId) { // If we need to focus on a specific collateral
                        // Scroll by the number of pixels required to display focused document (document position - beginning of scroll area)
                        $.mobile.silentScroll($('#docID_'+docId).offset().top - $('#mobileCommunityCollateralsContent').offset().top);
                    }
                }
            );
        };
        
        function renderDoc(currentDoc) {
        
            // href to linked document, if any
            var docHRef = "";
            // Direct URL to document, if any
            var docURL = "";
            
            // List of icons to display (document classification...)
            var iconSet = "";
            var badges = "";
            
            var isDoc = false;
            
            // Replaces backslashes, single quotes and end of lines
            var escapedLDescription = currentDoc.LDescription.replace(/\\/g,'/').replace(/'/g, '\\\'').replace(/\n/g,' ');
            var escapedLOwnerName = currentDoc.LOwnerName.replace(/\\/g,'/').replace(/'/g, '\\\'').replace(/\n/g,' ');
            var escapedLName = currentDoc.LName/*.replace(/\\/g,'/').replace(/'/g, '\\\'').replace(/\n/g,' ')*/;
        
            // Prepare icons displaying the type of document (client facing, practice approved, publish)
            if (currentDoc.ClientFacing) {
                badges += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_Approved.png')}", 'Client Facing');
            }
            if (currentDoc.PracticeApproved) {
                if (currentDoc.ClientFacing) {
                    badges += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_PracticeApproved.png')}", 'Practice Approved');   
                } else {
                    badges += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_PracticeApproved.png')}", 'Practice Approved Uno');
                }
            }
            
            // Depending on the type of collateral, prepare its display
            if (currentDoc.LType == 'Text') {
                // Nothing else to do
                isDoc = false;
            } else if (currentDoc.LType == 'Link or Document' || currentDoc.LType === 'Upload Document') {
                docURL = currentDoc.LURL;
                if (currentDoc.DocType == 'PDF') {
                    isDoc = true;
                    iconSet += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_File-Acrobat.png')}", 'PDF');
                } else if (currentDoc.DocType == 'PPT') {
                    isDoc = true;
                    iconSet += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_File-Powerpoint.png')}", 'PowerPoint');
                } else if (currentDoc.DocType == 'DOC') {
                    isDoc = true;
                    iconSet += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_File-Word.png')}", 'Word');
                } else if (currentDoc.DocType == 'XLS') {
                    isDoc = true;
                    iconSet += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_File-Excel.png')}", 'Excel');
                } else if (currentDoc.DocType == 'TXT') {
                    isDoc = true;
                    iconSet += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_TXT.png')}", 'Text');
                } else if (currentDoc.DocType == 'OTHER') {
                    isDoc = false;
                    iconSet += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_File-Web.png')}", 'Link');
                };
            } else if (currentDoc.LType == 'Video') {
                isDoc = false;
                iconSet += renderIcon("{!URLFOR($Resource.iconassets, 'icons/Icon_Video.png')}",'Video');
                docURL = currentDoc.LURL;
                if (currentDoc.LURL.indexOf('http') != 0) {
                    docURL = 'http://'+docURL; // Video links don't seem to have a protocol (http://) defined, so add it if needed
                }
            };
            
            if(docURL!=undefined)
                var escapedDocURL = docURL.replace(/\\/g,'/').replace(/'/g, '\\\'').replace(/\n/g,' ');
            if(escapedLName!=undefined)
                var escapedDocTitle = escapedLName.replace(/\\/g,'/').replace(/'/g, '\\\'').replace(/\n/g,' ');
            
            var avgRatingImg = renderRating(currentDoc.AvgRating);
            console.log(currentDoc);
            var content = '<li style=\"background-color: #ECECEC;height:95px; border:none; border-bottom:1px solid #a7a8a9;\">' + badges + '<div id="ownerDiv" style="position: absolute; right: 0; bottom:0; overflow: hidden; padding-right: 4px;"><h3 style="display: inline; float: left; padding-right: 10px; color: #767676; padding-top: 5px; text-shadow: none;font-size: 10pt; font-weight:100;">by '+ escapedLOwnerName +'</h3><img src=\"' + currentDoc.OwnerPhoto + '\" class=\"communityOwnerImg\" style="bottom: 4%;right: 4px;"></div><div id=\"mContainer\" style="width:80%"><div id="selection_check" onclick="NavigateUrl(\''+escapedDocURL +'\',\''+currentDoc.DocType+'\',\''+escapedLName+'\', \''+ $( '#commName' ).text() +'\', 0); sendMyRequestDownload(\''+escapedDocURL +'\',\''+currentDoc.DocType+'\',\''+escapedDocTitle +'\');\"><h3 style=\"color:#0096D6;margin:0px; font-size:13pt;\">'+escapedLName+'</h3><p style=\"white-space: normal !important; font-size:11pt; margin-top:0px; color:#a5a5a5; max-height:35px; height:35px;\">'+currentDoc.LDescription+'</p></div><div onclick="NavigateUrl(\''+escapedDocURL +'\',\''+currentDoc.DocType+'\',\''+escapedLName+'\', \''+ $( '#commName' ).text() +'\', 1); sendMyRequestDownload(\''+escapedDocURL +'\',\''+currentDoc.DocType+'\');\" id=\"imgDescContatiner\"  style=\"float:left;\">'+iconSet +'</div><span onclick="shareContent(\''+currentDoc.Lid+'\', \''+escapedLName+'\')" class="icon-share" style="font-size: 17pt;background-color:#0894D2; border-top-right-radius: 5px 5px;border-bottom-left-radius: 5px 5px; color:white; text-shadow: none;padding-left: 14px;margin-right: 7px;padding-right: 14px;padding-top: 7px;padding-bottom: 5px;"></span><div id=\"imgDescContatiner2\" style=\"padding-left: 10px; line-height: 40px;display:inline;\"><a href="#" style="text-decoration:none;" id="docLink_'+currentDoc.Lid+'" onclick="displayDocDetails(\''+currentDoc.Lid+'\',\''+currentDoc.LType+'\',\''+currentDoc.DocType+'\',\''+escapedDocTitle+'\',\''+escapedLOwnerName+'\',\''+currentDoc.OwnerPhoto+'\',\''+escapedDocURL+'\',\''+currentDoc.AvgRating+'\',\''+currentDoc.RatersCount+'\')";>'+avgRatingImg+'</a></div></div></li>';
                       
           
            // Create list entry. If there is no URL to a collateral, don't display data icon on the right
           // var content = "";
            /*content += '<li style="background-color: #404040;">'; 
            content += '<div id="mContainer"><div id="imgHeaderContainer">' + 
             '<img id="docImg" align="left" style="width:100px;height:80px;margin-right:7px;" src="' + currentDoc.DefaultImageName + '" onerror=\"this.src=\'{!URLFOR($Resource.mslp_pic, 'pic/9.png')}\'\;\"></img>' + 
             '</div>'
            //content += '</div>';
            content +='<h3 style="color:white;">'+escapedLName+'</h3>'+
                        '<p style="white-space: normal !important;height:50px;color:white;">'+currentDoc.LShortDescription+'</p>' +
                        '<div class="hr"><hr /></div>' +  
                        '<div id="imgDescContatiner"  style="float:left;">'+
                                iconSet + 
                            '</div>' +  
                        '<div id="imgRateContainer" style="float:right;">';         
           
            // Display current rating as stars ("on" or "off" to display the current rating)
            
            content += avgRatingImg;
            
            content +='</div>';
            content += '</li>';*/
            
            return content;
        };
        
        function renderIcon(iconURL, description) {
            if (description == 'PDF') {
                    return '<span class="icon-dload-pdf" style="font-size:20pt;background-color:#0894D2; border-top-right-radius: 5px 5px;border-bottom-left-radius: 5px 5px; color:white; text-shadow: none;padding: 3px;padding-left: 12px;margin-right: 7px;padding-right: 12px;"></span>';
                } else if (description == 'PowerPoint') {
                     return '<span class="icon-dload-powerpoint" style="font-size:20pt;background-color:#0894D2; border-top-right-radius: 5px 5px;border-bottom-left-radius: 5px 5px; color:white; text-shadow: none;padding: 3px;padding-left: 12px;margin-right: 7px;padding-right: 12px;"></span>';
                } else if (description == 'Word') {
                     return '<span class="icon-dload-word" style="font-size:20pt;background-color:#0894D2; border-top-right-radius: 5px 5px;border-bottom-left-radius: 5px 5px; color:white; text-shadow: none;padding: 3px;padding-left: 12px;margin-right: 7px;padding-right: 12px;"></span>';
                } else if (description == 'Excel') {
                     return '<span class="icon-dload-excel" style="font-size:20pt;background-color:#0894D2; border-top-right-radius: 5px 5px;border-bottom-left-radius: 5px 5px; color:white; text-shadow: none;padding: 3px;padding-left: 12px;margin-right: 7px;padding-right: 12px;"></span>';
                } else if (description == 'Link') {
                     return '<span class="icon-link" style="font-size:20pt;background-color:#0894D2; border-top-right-radius: 5px 5px;border-bottom-left-radius: 5px 5px; color:white; text-shadow: none;padding: 3px;padding-left: 12px;margin-right: 7px;padding-right: 12px;"></span>';
                } else if (description == 'Text') {
                     return '<span class="icon-dload-text" style="font-size:20pt;background-color:#0894D2; border-top-right-radius: 5px 5px;border-bottom-left-radius: 5px 5px; color:white; text-shadow: none;padding: 3px;padding-left: 12px;margin-right: 7px;padding-right: 12px;"></span>';
                }else if (description == 'Video') {
                      return '<span class="icon-video-camera" style="font-size:20pt;background-color:#0894D2; border-top-right-radius: 5px 5px;border-bottom-left-radius: 5px 5px; color:white; text-shadow: none;padding: 3px;padding-left: 12px;margin-right: 7px;padding-right: 12px;"></span>';
                }else if (description == 'Client Facing') {
                      return "<div class='iconDisplayBG2' style='float: right;background-color: #767676;min-height: 50%;margin-top: -10px; margin-right:-10px; padding-top:5px;'> <span class='icon-clientfacing_new iconPublish' style='text-shadow:none; color:white; font-size:16pt' title='Practice Approved' ></span> </div>"
                }
                else if (description == 'Practice Approved') {                     
                      return "<div class='iconDisplayBG' style='float: right;background-color: #767676;min-height: 50%;margin-top: -10px; margin-right:5px; padding-top:5px;'> <span class='icon-certified iconPublish ml_1' style='text-shadow:none; color:white; font-size:16pt' title='Practice Approved' ></span> </div>"
                }
                else if (description == 'Practice Approved Uno') {
                      return "<div class='iconDisplayBG2' style='float: right;background-color: #767676;min-height: 50%;margin-top: -10px; margin-right:-10px; padding-top:5px;'> <span class='icon-certified iconPublish ml_1' style='text-shadow:none; color:white; font-size:16pt' title='Practice Approved' ></span> </div>"
                };
        
                
            return '<span class="detailDoc"><img src="' + iconURL + '" '+(description?'title="'+description+'" ':' ')+'class="pull-right mrl"/></span>'
        };
        
        function showMemberDetails(mId) {
            console.log('show ' + mId);
            $("#memberPanelMain #memberFrame").remove();
            var viewportHeight = $(window).height() / 1.5;
            $( '#memberPanelMain' ).append( '<iframe src="/apex/mobileProfileNew?id=' + mId + '" height="' + viewportHeight + '" width="100%;" style="border:0px;" id="memberFrame"></iframe>' );
            $( '#memberPanel' ).popup('open');        
            console.log('ok');
        }
        
        function buildMembersList(sortM){
        
           var listCommContMem = '{!ContributorMember}';
           var parseCommContM = $.parseJSON(listCommContMem);


           if (sortM == 'undefined' || sortM == undefined) {
               $('#featuredList').empty();
               parseCommContM.sort(function(a,b) { 
                   if (a.UserName== null) {
                       return 1;
                   }
                   else if (b.UserName== null) {
                       return -1;
                   }
                   else{ 
                       return a.UserName.localeCompare(b.UserName) 
                   } 
               });
           }
           else if (sortM == 'UserName') {
               $('#featuredList').empty();
               parseCommContM.sort(function(a,b) { 
                   if (a.UserName== null) {
                       return 1;
                   }
                   else if (b.UserName== null) {
                       return -1;
                   }
                   else{ 
                       return a.UserName.localeCompare(b.UserName) 
                   } 
               });

           }
           else if (sortM == 'RoleName') {
               $('#featuredList').empty();
               parseCommContM.sort(function(a,b) { 
                   if (a.RoleName== null) {
                       return 1;
                   }
                   else if (b.RoleName== null) {
                       return -1;
                   }
                   else{ 
                       return a.RoleName.localeCompare(b.RoleName) 
                   } 
               });
           }
           else if (sortM == 'Region') {
               $('#featuredList').empty();
               parseCommContM.sort(function(a,b) { 
                   if (a.Region == null) {
                           return 1;
                   }
                   else if (b.Region == null) {
                       return -1;
                   }
                   else{ 
                       return a.Region.localeCompare(b.Region) 
                   } 
               });
           }
           else if (sortM == 'BusinessGroup') {
               $('#featuredList').empty();
               parseCommContM.sort(function(a,b) { 
                   if (a.BusinessGroup== null) {
                       return 1;
                   }
                   else if (b.BusinessGroup== null) {
                       return -1;
                   }
                   else{ 
                       return a.BusinessGroup.localeCompare(b.BusinessGroup) 
                   } 
               });

           }
                                           
           for (var iCount = 0; iCount < parseCommContM.length; iCount++) {
            var DisplayContributorMem = ("<li  data-icon=\"false\" onclick=\"showMemberDetails('" + parseCommContM[iCount].UserId + "')\" style=\"background-color:#767676; height:100px; width:30%; padding-left:5em; padding-right:2em; border-color:#767676;\">");
        
            //DisplayContributorMem += ("<a href=\"#popupBasic\" data-rel=\"popup\" data-transition=\"pop\" data-position-to=\"window\">");
            
            DisplayContributorMem += ("<img src=" + parseCommContM[iCount].Userphoto + " class=\"circular\" style=\"margin:7px; width:60px; height:60px; border-radius:30px; \"/>");
            
            DisplayContributorMem += ("<b style='text-shadow:none; color:white;'>" + parseCommContM[iCount].UserName + "</b>");
            
            DisplayContributorMem += (" <span class=\"ui-li-aside\" style=\"top:0.2em !important; right:0.4em !important; display:none;\">");
            
             if (parseCommContM[iCount].IsExperts) {
                DisplayContributorMem += (" <div class=\"iconDisplayBG3\" style='float: right;background-color: #0096D6;min-height: 100%; margin-top: -10px; margin-right:-5px; padding-top:6px;'><span class='icon-expert_new iconPublish verticalText' style='text-shadow:none; color:white; font-size:6pt; background-color: #0096D6;'  title='Expert'><span> E </span><span> X </span><span> P </span><span> E </span><span> R </span><span> T </span></span> </div> ");
            }
            if (parseCommContM[iCount].IsContributor) {
               // DisplayContributorMem += (" <div class=\"ui-li-icon-right iconDisplayBG4\" style='float: right;background-color: #0096D6;min-height: 100%;margin-top: -10px; margin-right:-10px; padding-top:5px;'> <span class='icon-clientfacing_new iconPublish' style='text-shadow:none; color:white; font-size:10pt' title='Practice Approved' ></span> </div> ");
            }
            
            DisplayContributorMem += (" </span>");
            
            if (parseCommContM[iCount].RoleName != '' && parseCommContM[iCount].RoleName != null) {
                DisplayContributorMem += ("<p style=\"background:transparent !important;text-shadow: none; position: relative; padding:0;\">"+parseCommContM[iCount].RoleName+"</p>");
            }
            
            if (parseCommContM[iCount].Region != '' && parseCommContM[iCount].Region != null) {
                DisplayContributorMem += ("<span style=\"font-size:12px;color:#fff;text-shadow: none; position: relative;\">" + parseCommContM[iCount].Region + "</span> ");
            }
            else {
                DisplayContributorMem += ("<span> &nbsp; </span> ");
            }
            if ((parseCommContM[iCount].Region != '' && parseCommContM[iCount].Region != null) && (parseCommContM[iCount].BusinessGroup != "" && parseCommContM[iCount].BusinessGroup != null)) {
                DisplayContributorMem += ("<span style=\"font-size:14px;color:#fff;text-shadow: none; position: relative;\"><b>" +" | "+ "</b></span> ");
            }
            if (parseCommContM[iCount].BusinessGroup != "" && parseCommContM[iCount].BusinessGroup != null) {
                DisplayContributorMem += ("<span style=\"font-size:12px;color:#fff;text-shadow: none; position: relative;\">" + parseCommContM[iCount].BusinessGroup + "</span> ");
            }
            else {
                DisplayContributorMem += ("<span> &nbsp; </span> ");
            }
            
            membersList.push({'id':parseCommContM[iCount].UserId});
            
            //DisplayContributorMem += ("</a>");
        
            DisplayContributorMem += ("</li>");
            $('#featuredList').append(DisplayContributorMem);
            $('#featuredList').listview('refresh');
         }
        
        } 
        
        function NavigateUrl(link, fileType, contentName, communityName, isDownload)
        {
            if ( isDownload ) {
               fileType = 'Document icon download - ' + fileType;
            }
            else {
               fileType = 'Document preview - ' + fileType;
            }
            
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.AthenaLearningBoardDtls.LogDownloadImageMetrics}',                      
                link,
                'id',
                contentName,
                fileType,    
                GetOSName(),
                GetBrowserName(),
                communityName,                                          
                'Mobile',                  
                DoNothing
            );
        }
        
        function DoNothing()
        {
        return true;
        }
        function GetOSName()
        {
        
          var ua = navigator.userAgent;
          var uaindex;
        
          // determine OS
          if ( ua.match(/iPad/i) || ua.match(/iPhone/i) )
          {
            mobileOS = 'iOS';
            uaindex  = ua.indexOf( 'OS ' );
          }
          else if ( ua.match(/Android/i) )
          {
            mobileOS = 'Android';
            uaindex  = ua.indexOf( 'Android ' );
          }
          else
          {
            mobileOS = ua; //'unknown-mobileOS';
          }
          return mobileOS;
        }
        
        function GetBrowserName()
        {
                 
        var nVer = navigator.appVersion;
        var nAgt = navigator.userAgent;
        var browserName  = navigator.appName;
        var fullVersion  = ''+parseFloat(navigator.appVersion); 
        var majorVersion = parseInt(navigator.appVersion,10);
        var nameOffset,verOffset,ix;
                                    if ((verOffset=nAgt.indexOf("Opera"))!=-1) {
         browserName = "Opera";
         fullVersion = nAgt.substring(verOffset+6);
         if ((verOffset=nAgt.indexOf("Version"))!=-1) 
                      fullVersion = nAgt.substring(verOffset+8);
        }
        // In MSIE, the true version is after "MSIE" in userAgent
        else if ((verOffset=nAgt.indexOf("MSIE"))!=-1) {
         browserName = "Microsoft Internet Explorer";
         fullVersion = nAgt.substring(verOffset+5);
        }
        // In Chrome, the true version is after "Chrome" 
        else if ((verOffset=nAgt.indexOf("Chrome"))!=-1) {
         browserName = "Chrome";
         fullVersion = nAgt.substring(verOffset+7);
        }
        // In Safari, the true version is after "Safari" or after "Version" 
        else if ((verOffset=nAgt.indexOf("Safari"))!=-1) {
         browserName = "Safari";
         fullVersion = nAgt.substring(verOffset+7);
         if ((verOffset=nAgt.indexOf("Version"))!=-1) 
                      fullVersion = nAgt.substring(verOffset+8);
        }
        // In Firefox, the true version is after "Firefox" 
        else if ((verOffset=nAgt.indexOf("Firefox"))!=-1) {
                     browserName = "Firefox";
                     fullVersion = nAgt.substring(verOffset+8);
        }
        // In most other browsers, "name/version" is at the end of userAgent 
        else if ( (nameOffset=nAgt.lastIndexOf(' ')+1) < (verOffset=nAgt.lastIndexOf('/')) ) {
                     browserName = nAgt.substring(nameOffset,verOffset);
                     fullVersion = nAgt.substring(verOffset+1);
                     if (browserName.toLowerCase()==browserName.toUpperCase()) {
                        browserName = navigator.appName;
                     }
        }
        var fVer = fullVersion.substring(0, fullVersion.indexOf(' '));
        return browserName + ' ' + fVer;
        
        }
        
        function sendMyRequestDownload(url, doctype, docTitle) {
        console.log('send req');
        var sDocType = doctype;
        
        if(sDocType == "OTHER"){ //Link is not to a document so we don't need key view just go to the url
         if(url.indexOf('http') != 0)
        {
            window.location = "http://" + url;
        }
        else{
            window.location = url;
        }
        return;
        }
        
        
        var start = url.lastIndexOf("/");
        var finish =  nth_occurrence (url, ":", 2);
        
        var parentDoc = url.substring(start+1, finish);
        
        var sDomain = getDomainName(url);
        
        var endpoint = '';
        if (sDomain == window.domainWWS) {
        if(nth_occurrence (url, ":", 2) > -1){
            endpoint = "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/action=query&text=*&databasematch=slp&totalresults=true&fieldtext=STRING%7B" + parentDoc + "%7D:drereference&printfields=drefilename";
        }
        else{
            endpoint = "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/a=query&text=*&printfields=drefilename&databasematch=SLP&IgnoreCache=true&IgnoreCache=true&matchreference=" + url;
        }
        }
        else if (sDomain == window.domainSP) {
        //endpoint = "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/a=query&text=*&databasematch=sharepoint&printFIELDS=drefilename&maxresults=1&fieldtext=MATCH%7b" + url + "%7d:FILEURL";
        //window.location = 'https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/A=view&noaci=true&outputtype=html&EmbedImages=true&reference=' + url
        //renderMyDoc(url, docTitle);
        window.location = "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/action=View&NoACI=true&OutputType=raw&EmbedImages=true&IgnoreCache=true&reference=" + url;
        return;
        }
        else if(sDomain == window.domainSP2013){
        //endpoint = "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/a=query&text=*&databasematch=sharepoint&printFIELDS=drefilename&maxresults=1&fieldtext=MATCH%7b" + url + "%7d:FILEURL";
        window.location = "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/action=View&NoACI=true&OutputType=raw&EmbedImages=true&IgnoreCache=true&reference=" + url;
        return;
        }
        else if(sDomain == window.domainEXO){
        window.location = url;
        return;
        }
        else if(sDomain == window.domainIntranet){
        //endpoint = "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/a=query&text=*&databasematch=sharepoint&printFIELDS=drefilename&maxresults=1&fieldtext=MATCH%7b" + url + "%7d:FILEURL";
        window.location = "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/action=View&NoACI=true&OutputType=raw&EmbedImages=true&IgnoreCache=true&reference=" + url;
        return;
        }
        
        else {
        // handle unknown case
        $('#popupDownloadMissing').popup('open');
        $('#popupDownloadMissing').popup('reposition', 'positionTo: window');
        return;
        }
        
        $.ajax({
        url: endpoint,
        dataType:'xml',
        type: 'GET',
        crossDomain: true,
        xhrFields: {
           withCredentials: true
        },
        success: function(xml) {
            $(xml).find('autnresponse').each(function(){
                $(this).find("responsedata").each(function(){
                    if ($(this).find("numhits").text() == '0'||$(this).find("numhits").text() == '') {
                      $('#popupDownloadMissing').popup('open');
                      $('#popupDownloadMissing').popup('reposition', 'positionTo: window');
                     return;
                     }
                     
                     var links = [];
                    $(this).find("hit").each(function(){
                        $(this).find("content").each(function(){
                            var link = $(this).text();
                            links.push(link);
                        });
                    });
                    
                   for (i = 0; i < links .length; i++) { 
                       var downloadDoc= links[i];  
                       doSetTimeout(i, downloadDoc)
                   }
        
               //}
                   
                });
            });
        },
        error: function (xhr, status) {
            //var er = jQuery.parseJSON(thrownError);
            if(isThisAndroid()&&xhr.status==0){
                $('#popupDownloadErr').popup('open');
                $('#popupDownloadErr').popup('reposition', 'positionTo: window');
            }
            else{
                alert('Error: Your security session has expired. Please sign out and sign in again');
            }  
        }
        });
        
        }
        
        function doSetTimeout(i, documentTitle) {
         setTimeout(function() {  
             window.location= "https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/action=View&NoACI=true&OutputType=raw&EmbedImages=true&IgnoreCache=true&reference=" + documentTitle; 
         }, i*1000);
        }
        
        function getDomainName(url) {
        var r = /:\/\/(.[^/]+)/;
        return url.match(r)[1];
        //return $('#basic').val().match(r)[1];
        }
        
        function renderMyDoc(url, docTitle) {
        //window.location = 'https://it-services-gw-itg.external.hp.com/gw/esit/sfdc/idol.dev/A=view&noaci=true&outputtype=html&EmbedImages=true&IgnoreCache=true&reference=' + url
        window.location.href="/apex/mobileDocViewer?docURL=" + url + "&&docTitle=" + docTitle;
        }
        
        function isPopulated(elementId)
        {
            console.log("isPopulated function");
            var populated = false;    
            
            // check if the value of the html element has a truthy value or not.     
            if ($("[id$=" + elementId + "]").val())
            {
                populated = true;
            }
            console.log("The text input populated - " +populated ); 
            return populated;
        }
        
         function postComment() {
            
            if($("#fnameComment2").val()){
                if($("#fnameComment2").val().length > 5000){
                    alert("There is a limit of 5000 characters, you have entered " + $("#fnameComment2").val().length + " characters.");
                    return;
                    
                }
                else{
                    $("#commentButton").addClass('ui-disabled');
                }
            }
            else{
                alert("Please enter some text");
            }
            
            // Get values from jQM form
            var comment= $("#fnameComment2").val();
            // Copy values into SF form (use "[id$=" to find element based on id suffix as SF adds prefix to it)
            $("[id$=txtPostInputComment2]").val(comment);
            // Simulate click on SF submit button
            $("[id$=cmdBtnPostComment2]").click();
            //return false;
        }
        
        function postReply(replyInput, replyId) {
            $("[id$=txtUserTopicComment]").text("'"+replyId+"'");
        
            if ($( replyInput ).val()) {
                if($( replyInput ).val().length > 5000){
                    alert("There is a limit of 5000 characters, you have entered " + $("#fname2").val().length + " characters.");
                    return;
                    
                }
                else{
                    //$(replyButton).addClass('ui-disabled');
                }
            }
            else{
                alert("Please enter some text");
            }
            
            // Get values from jQM form
            var comment= $(replyInput).val();
            
            $("[id$=txtPostInput2]").val(comment);
            //alert($("[id$=txtPostInput2]").val() + ', ' + $("[id$=txtUserTopicComment]").val() );
            $("[id$=cmdBtnPost26]").click();
        }        
        
        function nth_occurrence (string, char, nth) {
            var first_index = string.indexOf(char);
            var length_up_to_first_index = first_index + 1;
        
            if (nth == 1) {
                return first_index;
            } else {
                var string_after_first_occurrence = string.slice(length_up_to_first_index);
                var next_occurrence = nth_occurrence(string_after_first_occurrence, char, nth - 1);
        
                if (next_occurrence === -1) {
                    return -1;
                } else {
                    return length_up_to_first_index + next_occurrence;  
                }
            }
        }    
        

        function displayDocDetails(id, docLType, docDocType, docLName, docLOwnerName, docOwnerPhoto, docURL, avgRating, ratersCount) {
            console.log("Rating = " + avgRating + " count = " + ratersCount);
            var txtCommunityTopicID = $('[id$=txtCommunityTopicID]');
            txtCommunityTopicID.val(id);
           
            $('#popupDocLName').text(docLName);
            var ratingStarImgs = renderRating(avgRating);
            $('#popupRatingimages').html(ratingStarImgs);
             var ratersCountTxt = "";
            if (ratersCount > 0) {
                ratersCountTxt = ratersCount + ' user'+((ratersCount > 1)?'s':'');
            }
            else{
                ratersCountTxt = "0 users";
            }
            $('#popupRatingUsers').text(ratersCountTxt);
            
            $( "#ratePanel" ).popup( "open");
            
            //$('#rateMyCollateralPop').popup('open');
            //$('#rateMyCollateralPop').popup('reposition', 'positionTo: window');
            /*
            
            if (docURL) {
                $("#popupDownloadButton").attr("href", docURL).css("visibility", "visible");
             } else {
                $("#popupDownloadButton").attr("href", "#").css("visibility", "hidden");
            }
            
            $.mobile.pageContainer.pagecontainer('change', '#mobileCommunityCollateralsDetails');*/

            return false;
        };
        
        // Function called when rating a document: copy jQM form values into SF form anf submit SF form
        function rateDocument() {
        
        $("#rateButton").addClass('ui-disabled');
        
            // Get values from jQM form
            var rating = $("#ratingSlider").val();
            var ratingComments = $("#ratingComments").val();
            
            // Copy values into SF form (use "[id$=" to find element based on id suffix as SF adds prefix to it)
            $("[id$=txtUserTopicRatingComment]").text(ratingComments);
            $("[id$=txtTopicScore]").val(rating) /*.selectmenu('refresh') */;
            
            // Simulate click on SF submit button
            $("[id$=btnUserRating]").click();
            return false;
        }
        
        function performFollowAction(){
            // Simulate click on SF submit button
            $("[id$=CommandButton1]").click();
            return false;
        }
        
        function performUnfollowAction(){
            // Simulate click on SF submit button
            $("[id$=CommandButton2]").click();
            return false;
        }
        
        function viewOwnerProfile() {
            var mId = '{!LearningBoardOwnerDtls.id}';           
            $("#memberPanelMain #memberFrame").remove();
            var viewportHeight = $(window).height() / 1.5;
            $( '#memberPanelMain' ).append( '<iframe src="/apex/mobileProfileNew?id=' + mId + '" height="' + viewportHeight + '" width="100%;" style="border:0px;" id="memberFrame"></iframe>' );
            $( '#memberPanel' ).popup('open');        

        }



    </script>
</apex:page>